<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bid - Arena</title>
    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!-- Font-icon css-->
    <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body class="app sidebar-mini">
    <!-- NOTE: START: -->
    <!-- loader -->
    <div class="overlay"></div>
    <div class="spanner">
        <div class="loader"></div>
        <!-- <p>Uploading music file, please be patient.</p> -->
    </div>
    <!-- END: -->
    <!-- Navbar-->
    <header class="app-header"><a class="app-header__logo" href="#">Arena</a>
        <!-- Sidebar toggle button--><a class="app-sidebar__toggle" href="#" data-toggle="sidebar"
            aria-label="Hide Sidebar"></a>
        <!-- Navbar Right Menu-->
        <ul class="app-nav">
            <!-- User Menu-->
            <li><a class="app-nav__item" style="font-size: 15px;text-decoration: none;" href="passbook.html"><span
                        style="border: 1px solid white;padding: 3px;border-radius: 5px;"><img height="17px"
                            style="margin-top:-3px;" src="./assets/shapes/et_wallet.svg" alt="">&nbsp;50</span></a>
            </li>
        </ul>
    </header>
    <!-- Sidebar menu-->
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <aside class="app-sidebar">
        <div class="app-sidebar__user">
            <img class="app-sidebar__user-avatar"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAM1BMVEXk5ueutLfn6eqrsbTp6+zg4uOwtrnJzc/j5earsbW0uby4vcDQ09XGyszU19jd3+G/xMamCvwDAAAFLklEQVR4nO2d2bLbIAxAbYE3sDH//7WFbPfexG4MiCAcnWmnrzkjIRaD2jQMwzAMwzAMwzAMwzAMwzAMwzAMwzAMwzAMwzAMw5wQkHJczewxZh2lhNK/CBOQo1n0JIT74/H/qMV0Z7GU3aCcVPuEE1XDCtVLAhgtpme7H0s1N1U7QjO0L8F7llzGeh1hEG/8Lo7TUmmuSrOfns9xnGXpXxsONPpA/B6OqqstjC6Ax/0ujkNdYQQbKNi2k64qiiEZ+ohi35X+2YcZw/WujmslYewiAliVYrxgJYrdwUmwXsU+RdApUi83oNIE27YvrfB/ZPg8+BJETXnqh9CVzBbTQHgojgiCvtqU9thFJg/CKz3VIMKMEkIXxIWqIpIg2SkjYj+xC816mrJae2aiWGykxRNsW0UwiJghJDljYI5CD8GRiCtIsJxizYUPQ2pzItZy5pcisTRdk/a9m4amtNNfBuQkdVhSaYqfpNTSFGfb9GRIakrE2Pm+GFLaCQPqiu0OpWP+HMPQQcgQMiQprWXNmsVwIjQjYi/ZrhAqNTCgr2gu0Jnz85RSSjso0HkMFZ0YZjKkc26a/jlmh9JiDyDxi9oeorTYAzZkwwoMz19pzj9bnH/GP/+qbchjSGflneWYhtTuKdMOmNKZcJ5TjInQKcYXnESd/jQxy0ENpULTNGOGgxpap/oyw9pbUAqhfx2Dbkhovvfgz4iUzoM9+GlK6/Mh4q29hyC1mwro30hpVVLPF9wYQr71RazOeM5/cw81iBRD+A03aM9/C/obbrKjbYSpCmIVG3qT/Q8oeUo3Rz0IL7vI1tEbCB9pSiu8I/aV8x3Kg/BGWrWp4ZVs0nZfmAoEG4h/61yHYIJiFSl6Q0Vk6tTW1N8kYp8hdOkfHYYMXd2Qft+8CYwqYDSKvqIh+MCF8Wgca2u/cwdgeW3TtuVn6+1oBs3yLo5C2JpK6CvQzGpfUkz9UG/87gCsi5o2LIXolxN0FbwAsjOLEr+YJmXn7iR6N0BCt5p5cMxm7eAsfS+/CACQf4CTpKjzgkvr2cVarVTf96372yut7XLJ1sa7lv6VcfgYrWaxqr3Wlo1S6pvStr22sxOtTNPLzdY3nj20bPP+ejFdJYkLsjGLdtPBEbe/mr2bQKiXWJDroA+vtzc0p9aahuwqHMDYrQEXHEw9jwQl3drMpts9JBU1SdktPe5FBRdJQ6bwXBpa57ib2A8kukQDzMjh++Uo7Fo6Wd02Pkf4fknqoo4HtvAIjsqUcjx6DIPgWCaOML9rKI/oqD9/lgNrn+eF+p7j8tnzHBiR7+kdUGw/+V1Kzkc75mMy6U+FMaxjPibiM1U1uGM+puInHpmALZCgP4pt7i840MV8+0R1zPsRB6UTcqpizncYwZ89syDydfyWCwXB1l8/zRNGWbTG/GHKUm9AkxHMc/EGSk3z2+ArEhPEV5TUBLEvUGFcjEUH80J/jveTGOAJEljJbILWGQT3zRYiwuKsUXN1EEJAzBhRJFll7mBUG7KD8EqPkKekBREaL8hMDZLQSG6AQjtHPYmvTQnX0TtpC1SYCe2YdkkyLP3jj5BSbKiuR585eQhTgoje6yIb0Yb0C+mV6EYvebqw5SDy2WmubogZiF2AVxPC2FpDf8H2Q9QWo6IkjUxTWVEI3WY/wrCeSuqJ+eRWzXR/JXwgVjUMozbCOfoEZiSiKVGepqv5CJ8RyR4D7xBeamqa7z3BJ/z17JxuBPdv93d/a2Ki878MMAzDMAzDMAzDMAzDMF/KP09VUmxBAiI3AAAAAElFTkSuQmCC"
                alt="User Image">
            <p class="app-sidebar__user-name" id="side_bar_username_id"></p>
            <p class="app-sidebar__user-designation" id="side_bar_usernumber_id"></p>
            <a href="profile.html"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit Profile</a>
        </div>
        <ul class="app-menu">
            <li><a class="app-menu__item" href="home.html"><i class="app-menu__icon fa fa-home"></i><span
                        class="app-menu__label">Home</span></a>
            </li>
            <li><a class="app-menu__item" href="game-rate.html"><i class="app-menu__icon fa  fa-inr"></i><span
                        class="app-menu__label">Game Rate</span></a>
            </li>
            <li class="treeview"><a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon fa fa-history"></i><span class="app-menu__label">History</span><i
                        class="treeview-indicator fa fa-angle-right"></i></a>
                <ul class="treeview-menu">
                    <li><a class="treeview-item" href="bid-history.html"><i class="icon fa fa-circle-o"></i>Bidding
                            History</a></li>
                    <li><a class="treeview-item" href="win-history.html"><i class="icon fa fa-circle-o"></i>Winning
                            History</a>
                    </li>
                    <li><a class="treeview-item" href="deposite-history.html"><i class="icon fa fa-circle-o"></i>Deposit
                            History</a>
                    </li>
                    <li><a class="treeview-item" href="withdrawal-history.html"><i
                                class="icon fa fa-circle-o"></i>Withdrawal
                            History</a>
                    </li>
                </ul>
            </li>
            <li><a class="app-menu__item" href="withdrawal.html"><i class="app-menu__icon fa fa-money"></i><span
                        class="app-menu__label">Withdrawal</span></a></li>
            <li class="treeview"><a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon fa fa-handshake-o"></i><span class="app-menu__label">Help</span><i
                        class="treeview-indicator fa fa-angle-right"></i></a>
                <ul class="treeview-menu">
                    <li><a class="treeview-item" href="form-components.html"><i class="icon fa fa-circle-o"></i> Form
                            How to Play</a></li>
                    <li><a class="treeview-item" href="form-custom.html"><i class="icon fa fa-circle-o"></i> Custom
                            Game Rate Card</a></li>
                    <li><a class="treeview-item" href="form-samples.html"><i class="icon fa fa-circle-o"></i> Form
                            Notice </a></li>
                    <li><a class="treeview-item" href="form-notifications.html"><i class="icon fa fa-circle-o"></i> Form
                            Rules Board</a></li>
                </ul>
            </li>
            <li><a class="app-menu__item" href="contact-us.html"><i class="app-menu__icon fa fa-headphones"></i><span
                        class="app-menu__label">Contact Us</span></a></li>
            <li><a class="app-menu__item" href="share.html"><i class="app-menu__icon fa fa-share-alt"></i><span
                        class="app-menu__label">Share with Friends</span></a></li>
            <li><a class="app-menu__item" href="#" onclick="signOut()"><i
                        class="app-menu__icon fa fa-sign-out"></i><span class="app-menu__label">Logout</span></a></li>
        </ul>
    </aside>
    <main class="app-content">
        <div class="bid_top_bar">
            <p><i class="fa fa-chevron-left"
                    onclick=" sessionStorage.removeItem('current_bid_type'); navigate('game.html')"
                    aria-hidden="true"></i><span id="current_bid_type_id"></span></p>
            <p><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp;<span id="countdown_id">0h : 0m : 0s</span></p>
        </div>
        <script>
            var currentBidType = sessionStorage.getItem("current_bid_type");
            if (currentBidType == null) {
                location.href = 'game.html';
            }
            var gameDetails = JSON.parse(sessionStorage.getItem('gameDetails'))
            if (gameDetails == null) {
                location.href = 'home.html'
            }
            document.getElementById('current_bid_type_id').innerHTML = `&nbsp;&nbsp;&nbsp;${gameDetails.market_fullname} - ` + currentBidType
        </script>
        <div class="d-flex justify-content-between mt-4">
            <div class="bid_open_close_btn">
                <div class="form-check ">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
                    <span class="checkmark"></span>&nbsp;&nbsp;
                    <label class="form-check-label" for="flexRadioDefault1">
                        OPEN
                    </label>
                </div>
            </div>
            <div class="bid_open_close_btn">
                <div class="form-check ">
                    <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                    <span class="checkmark"></span>&nbsp;&nbsp;
                    <label class="form-check-label" for="flexRadioDefault2">
                        CLOSE
                    </label>
                </div>
            </div>
        </div>
        <div class="bid_input_box mt-4 pt-2 pl-4 pr-4 pb-2">
            <div class="d-flex justify-content-between">
                <span id="digit_input_field_id"></span>
                <input type="number" placeholder="Enter Point" id="bid_point_input">
            </div>
            <div class="d-flex justify-content-center mt-3">
                <button onclick="handleProceedClick()">PROCEED</button>
            </div>
        </div>
        <script>
            if (currentBidType == 'SD') {
                document.getElementById('digit_input_field_id').innerHTML = `<input type="text" placeholder="Enter Digit" maxlength="1"
                    oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="input_field_digit" />`
            } else if (currentBidType == 'JD') {
                document.getElementById('digit_input_field_id').innerHTML = `<input type="text" placeholder="Enter Digit" maxlength="2"
                    oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="input_field_digit" />`
            } else if (currentBidType == 'SP' || currentBidType == 'DP' || currentBidType == 'TP' || currentBidType == 'HS' || currentBidType == 'FS') {
                document.getElementById('digit_input_field_id').innerHTML = `<input type="text" placeholder="Enter Digit" maxlength="3"
                    oninput="this.value=this.value.replace(/[^0-9]/g,'');" id="input_field_digit" />`
            }
            var bidList = [];
        </script>
        <div class="bid_list_table_container mt-3">
            <table class="table" id="bidTable_id">
            </table>
            <div
                style="height: 30px;padding: 5px 10px;position: fixed;bottom: 86px;border-radius: 9px;width: 90vw;right: 15px;background-color: white;">
                <p class="float-right" style="color: black;">
                    <b>Total: â‚¹<span id="totalBidValue"></span></b>
                </p>
            </div>
        </div>
        <div class="d-flex justify-content-center mt-4">
            <button class="bid_play_btn" id="bid_play" onclick="handlePlay()">PLAY</button>
        </div>
        <script>
            var bidTable = document.getElementById("bidTable_id");
            createBidTable()
            function createBidTable() {
                let totalValue = 0
                bidTable.innerHTML = `<tr>
                    <th class="text-center">Pana</th>
                    <th class="text-center">Point</th>
                    <th class="text-center">Game</th>
                    <th class="text-center">Action</th>
                </tr>`
                for (let i = 0; i < bidList.length; i++) {
                    totalValue = totalValue + bidList[i].bidPoint
                    var row = bidTable.insertRow(i + 1);
                    row.innerHTML = `<td class="text-center">${bidList[i].number}</td>
                        <td class="text-center">${bidList[i].points}</td>
                        <td class="text-center">${currentBidType}</td>
                        <td class="text-center"><i class="fa fa-trash text-danger" aria-hidden="true" onclick="removeBidItem(${i})"></i></td>`
                }
                document.getElementById('totalBidValue').innerHTML = totalValue
                if (bidList?.length == 0) {
                    // document.getElementById('bid_play').className = 'bid_play_btn_disable'
                    document.getElementById('bid_play').disabled = true
                } else {
                    // document.getElementById('bid_play').className = 'bid_play_btn'
                    document.getElementById('bid_play').disabled = false
                }
            }
            function handleProceedClick() {
                let inputFieldDigit = document.getElementById('input_field_digit')
                let bidPointInput = document.getElementById('bid_point_input')
                if (inputFieldDigit.value == "") {
                    $.notify({
                        title: "",
                        message: `Please enter digit`,
                        icon: 'fa fa-times'
                    }, {
                        type: "danger"
                    });
                    return
                }
                if (currentBidType == 'JD') {
                    if (inputFieldDigit.value.length != 2) {
                        $.notify({
                            title: "",
                            message: `Please enter proper digit`,
                            icon: 'fa fa-times'
                        }, {
                            type: "danger"
                        });
                        return
                    }
                }
                if (currentBidType == 'SP') {
                    if (inputFieldDigit.value.length != 3) {
                        $.notify({
                            title: "",
                            message: `Please enter proper digit`,
                            icon: 'fa fa-times'
                        }, {
                            type: "danger"
                        });
                        return
                    }
                }
                if (currentBidType == 'DP') {
                    if (inputFieldDigit.value.length != 3) {
                        $.notify({
                            title: "",
                            message: `Please enter proper digit`,
                            icon: 'fa fa-times'
                        }, {
                            type: "danger"
                        });
                        return
                    }
                }
                if (bidPointInput.value == "") {
                    $.notify({
                        title: "",
                        message: `Please enter point`,
                        icon: 'fa fa-times'
                    }, {
                        type: "danger"
                    });
                    return
                }
                let game_type = 'open'
                let flexRadioDefault2 = document.getElementById('flexRadioDefault2').checked
                if (flexRadioDefault2) {
                    game_type = 'close'
                }
                bidList.push({
                    number: parseInt(inputFieldDigit.value),
                    points: parseInt(bidPointInput.value),
                    game_type: game_type
                })
                console.log(bidList)
                inputFieldDigit.value = ''
                bidPointInput.value = ''
                createBidTable()
            }
            function removeBidItem(index) {
                bidList.splice(index, 1)
                createBidTable()
            }
        </script>
    </main>
    <!-- Essential javascripts for application to work-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="./js/globalFunction.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap-notify.min.js"></script>
    <script type="text/javascript">
        authenticate()
        let cookieData = getCookie("jwt");
        let username = document.getElementById('side_bar_username_id')
        let usernumber = document.getElementById('side_bar_usernumber_id')
        if (cookieData) {
            username.innerText = cookieData?.name
            usernumber.innerText = cookieData?.user_phonenumber
        }
        var todayDate = new Date();
        let todayDay = todayDate.getDate();
        let todayMonth = getDateInWord(todayDate.getMonth()+1)
        let todayYear = todayDate.getFullYear()
        var countDownDate = new Date(`${todayMonth} ${todayDay},${todayYear} ${gameDetails?.market_closetime}`).getTime();

        // Update the count down every 1 second
        var x = setInterval(function () {
            var now = new Date().getTime();
            var distance = countDownDate - now;
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("countdown_id").innerHTML = hours + "h : "
                + minutes + "m : " + seconds + "s ";

            // If the count down is over, write some text 
            if (distance < 0) {
                clearInterval(x);
                document.getElementById("countdown_id").innerHTML = "0h : 0m : 0s";
            }
        }, 1000);
        function handlePlay() {
            startLoader()
            axiosInstance.post('save_bid', {
                "game_name": currentBidType,
                "market_id": gameDetails?.market_id,
                "user_id": cookieData?.user_id,
                "bid_lists": bidList

            }).then((response) => {
                endLoader()
                if (response.status === 200) {
                } else {
                    $.notify({
                        title: "",
                        message: `status ${response.status}`,
                        icon: 'fa fa-times'
                    }, {
                        type: "danger"
                    });
                }
                console.log(response)
            }, (error) => {
                console.log('error', error);
                endLoader()
                $.notify({
                    title: "",
                    message: `Something went wrong! Please try again.`,
                    icon: 'fa fa-times'
                }, {
                    type: "danger"
                });
            })
        }
    </script>
</body>

</html>